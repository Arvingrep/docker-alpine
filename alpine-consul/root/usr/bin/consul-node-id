#!/usr/bin/with-contenv sh

#
# This script provides an entry point to customise the `-node-id` arguments
# passed to consul when starting in agent mode.
#

# Use this rather than a -node-id generated by Consul because they were clashing.
NODE_ID=$(cat /proc/sys/kernel/random/uuid | sed 's/.\{12\}$/'"$(hostname)"'/')

# Output debug messages if required.
if [ "$CONSUL_DEBUG" = "true" ]; then
    (>&2 echo "[consul-node-id] node-id: $NODE_ID...")
fi

echo $NODE_ID
exit 0
